<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Camera Nh·∫≠n Di·ªán</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
body{
    background:#000;
    color:#0f0;
    font-family:Arial;
    text-align:center;
}
video,canvas{
    width:100%;
    max-width:360px;
    border:2px solid #0f0;
}
button{
    margin:10px;
    padding:10px 20px;
    font-size:16px;
    background:#0f0;
    border:none;
    cursor:pointer;
}
#info{
    font-size:14px;
    text-align:left;
    max-width:360px;
    margin:auto;
}
</style>
</head>

<body>

<h2>üì∑ AI Nh·∫≠n Di·ªán ƒê·ªì V·∫≠t</h2>

<button onclick="start()">‚ñ∂Ô∏è B·∫¨T CAMERA</button>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>

<div id="info">Nh·∫•n "B·∫¨T CAMERA" ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const info = document.getElementById("info");

let model = null;

const PRICE = {
    "cell phone":"5.000.000ƒë",
    "laptop":"15.000.000ƒë",
    "bottle":"20.000ƒë",
    "cup":"15.000ƒë",
    "book":"50.000ƒë",
    "keyboard":"300.000ƒë",
    "mouse":"150.000ƒë",
    "person":"Kh√¥ng x√°c ƒë·ªãnh"
};

async function start(){
    info.innerHTML = "‚è≥ ƒêang m·ªü camera...";
    await startCamera();
    await loadAI();
}

async function startCamera(){
    const stream = await navigator.mediaDevices.getUserMedia({
        video:{ facingMode:"environment" },
        audio:false
    });
    video.srcObject = stream;

    video.onloadedmetadata = ()=>{
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
    };
}

async function loadAI(){
    info.innerHTML = "‚è≥ ƒêang t·∫£i AI...";
    model = await cocoSsd.load();
    info.innerHTML = "‚úÖ AI s·∫µn s√†ng";
    detect();
}

async function detect(){
    if(!model) return;

    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const predictions = await model.detect(canvas);

    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(video,0,0,canvas.width,canvas.height);

    info.innerHTML = "";

    predictions.forEach(p=>{
        if(p.score < 0.5) return;

        const [x,y,w,h] = p.bbox;
        ctx.strokeStyle="#0f0";
        ctx.lineWidth=2;
        ctx.strokeRect(x,y,w,h);
        ctx.fillStyle="#0f0";
        ctx.fillText(p.class,x,y-5);

        info.innerHTML += `
        üì¶ <b>${p.class}</b><br>
        üéØ ${(p.score*100).toFixed(1)}%<br>
        üí∞ ${PRICE[p.class] || "Ch∆∞a c√≥ gi√°"}<br><br>
        `;
    });

    setTimeout(detect,300);
}
</script>

</body>
</html>
